pipeline {
    agent any
    
    environment {
        SECRET_KEY = credentials('aes-secret-key') // 32字节
        INIT_VECTOR = credentials('aes-iv')        // 16字节
    }
    
    stages {
        stage('Safe Encrypt') {
            steps {
                script {
                    // 使用 Jenkins 安全的 Base64 编码
                    def plainText = "Secret Data"
                    
                    // 加密方法（沙箱安全）
                    def encrypted = encryptSafe(plainText, env.SECRET_KEY, env.INIT_VECTOR)
                    env.ENCRYPTED_TEXT = encrypted
                    
                    echo "Encrypted: ${encrypted.take(10)}..." // 显示部分避免暴露
                }
            }
        }
    }
}

// 沙箱安全的加密方法
def encryptSafe(String plainText, String secretKey, String iv) {
    // 使用 Jenkins 内置的 Base64 编码避免安全限制
    def base64 = org.apache.commons.codec.binary.Base64
    
    // 使用批准的加密库
    def cipher = javax.crypto.Cipher.getInstance("AES/CBC/PKCS5Padding")
    def keySpec = new javax.crypto.spec.SecretKeySpec(secretKey.getBytes("UTF-8"), "AES")
    def ivSpec = new javax.crypto.spec.IvParameterSpec(iv.getBytes("UTF-8"))
    
    cipher.init(javax.crypto.Cipher.ENCRYPT_MODE, keySpec, ivSpec)
    byte[] encrypted = cipher.doFinal(plainText.getBytes("UTF-8"))
    
    return base64.encodeBase64String(encrypted)
}

stage('Decrypt') {
    steps {
        sh '''
            #!/bin/bash
            echo "Decrypting with OpenSSL..."
            
            DECRYPTED=$(echo -n "$ENCRYPTED_TEXT" | base64 -d | openssl enc -d -aes-256-cbc \
                -K $(echo -n "$SECRET_KEY" | xxd -p) \
                -iv $(echo -n "$INIT_VECTOR" | xxd -p))
            
            echo "Decrypted: ${DECRYPTED:0:10}..." # 显示部分
        '''
    }
}


Since filter-repo61 is not a native git sub-command, you need to first install it. 
Python 3.6+ and Git 2.22+ needed. Set directory which locate "git-filter-repo" raw file into $PATH env, and set "+x", then you're able to use "git filter-repo" command for following actions. Otherwise, type "python3 git-filter-repo" instead. 
• Clone repository • Check branch which contains the target file • Find the target files and commit history id 
git rev-list --objects --all | grep -f <(git verify-pack -v .git/objects/pack/*.idx | sort -k 3 -n I cut -f 1-d " " | tail -10) • Start filtering these large files by passing the path & name of the file you would like to remove 
git filter-repo --path-globi*.zip' --invert-paths --force Here, also support "path", "path-match", "path-regex" to set search pattern. • Add repository remote URL git remote add origin curl> • Push to remote 
git push --all --force git push --tags --force 



git filter-repo --path-glob *.zip --invert-paths --force


git filter-repo --path-glob *.png --invert-paths --force



consume your 

Jenkins Installation or Upgrade Procedure
1. Download and Upload Jenkins WAR Package

Download the WAR package from the official Jenkins website.

Upload the file to the Artifactory server.

Onboard it through a JSM request.

Open a CHG (Change Request) and wait for approval.

2. Upgrade on Jenkins Production Server

Log in to the Jenkins Production machine.

Download the WAR package from the Artifactory server to the directory:

/d/d1/jenkins


Stop Jenkins:

systemctl --user stop jenkins


Switch the symbolic link:

ln -s jenkins_version.war jenkins.war


Start Jenkins:

systemctl --user start jenkins

3. Install or Upgrade Plugins (QA Environment)

Log in to Jenkins QA.

Navigate to Manage Jenkins → Manage Plugins → Available.

Search and install (or upgrade) the plugins you need.

Click OK when installation is complete.

4. Publish Plugin Updates to Artifactory

Log in to the Jenkins QA machine.

Download the script repository jenkins_scripts.

Go to the plugins subfolder.

Run the upload script:

./upgrade.sh


This script uploads the plugins to the Artifactory server.

Raise a CHG and wait for approval.

5. Upgrade Plugins on Jenkins Production

Log in to the Jenkins Production machine.

Stop Jenkins:

systemctl --user stop jenkins


Go to the Jenkins data directory:

/d/d1/jenkins/data/


Back up the current plugins folder:

cp ./plugins ../plugins_bk_$(date +%F_%T) -r


Download the script repository jenkins_scripts.

Go to the plugins subfolder.

Run the download script:

./download.sh


Start Jenkins:

systemctl --user start jenkins








